<html>
<head>
  <meta charset="utf-8">
  <title>msgpack-lite demo</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet">
  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.1.10/es5-shim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js"></script>
  <![endif]-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="https://rawgithub.com/kawanet/msgpack-lite/master/dist/msgpack.min.js"></script>
  <!--
  <script src="../dist/msgpack.browserify.js"></script>
  <script src="../dist/msgpack.min.js"></script>
  -->
  <script>
    $(function() {
      var $source = $("#source").on("change", encode).on("keyup", encode);
      var $buffer = $("#buffer").on("change", decode).on("keyup", decode);
      $("#encode, #hex, #array").on("click", encode);
      $("#decode").on("click", decode);
      var spacer = "  ";

      var sample = {
        "int": 1,
        "float": 0.5,
        "boolean": true,
        "null": null,
        "string": "foo bar",
        "array": ["foo", "bar"],
        "object": {
          "foo": 1,
          "baz": 0.5
        }
      };
      $source.val(JSON.stringify(sample, null, spacer));
      encode();

      function encode() {
        try {
          var json = $source.val();
          var data = JSON.parse(json);
          var buffer = msgpack.encode(data);
          var ishex = $("#hex:checked").length;
          var binary = ishex ? buffer_to_hex(buffer) : buffer_to_array(buffer);
          $buffer.val(binary);
        } catch (e) {
          $buffer.val(e + "");
        }
      }

      function buffer_to_hex(buffer) {
        return Array.prototype.map.call(buffer, function(val) {
          var hex = (val).toString(16).toUpperCase();
          if (val < 16) hex = "0" + hex;
          return hex;
        }).join(" ");
      }

      function buffer_to_array(buffer) {
        return JSON.stringify(Array.prototype.slice.apply(buffer)).replace(/,/g, ", ");
      }

      function decode() {
        try {
          var string = $buffer.val();
          var ishex = string.search(/\[.*\]/) < 0;
          var array = ishex ? hex_to_buffer(string) : array_to_buffer(string);
          var buffer = new Uint8Array(array);
          var data = msgpack.decode(buffer);
          var json = JSON.stringify(data, null, spacer);
          $source.val(json);
        } catch (e) {
          $source.val(e + "");
        }
      }

      function hex_to_buffer(string) {
        return string.split(/\s+/).filter(function(chr) {
          return (chr !== "");
        }).map(function(chr) {
          return parseInt(chr, 16);
        });
      }

      function array_to_buffer(string) {
        return JSON.parse(string);
      }
    });
  </script>
  <style>
    #encode, #decode {
      margin-top: 100px;
      margin-top: 25vh;
    }

    h5 {
      margin-top: 0;
    }

    h5 label {
      margin-left: 10px;
    }

    #main {
      height: 100%;
      margin-top: -120px;
      padding-top: 120px;
    }

    #main textarea {
      height: 100%;
      font-family: monospace;
    }
  </style>
</head>
<body>
<form onsubmit="return false;">

  <div class="navbar navbar-inverse navbar-static-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-brand">
        msgpack-lite
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-left">
          <li class="active">
            <a href="./">Demo</a>
          </li>
          <li>
            <a href="https://github.com/kawanet/msgpack-lite">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div id="main" class="container-fluid">
    <div class="row">
      <div class="col-sm-5">
        <h5 for="source">JSON</h5>
        <textarea class="form-control" id="source"></textarea>
      </div>
      <div class="col-sm-2">
        <button id="encode" class="convert btn-primary form-control">
          <span class="glyphicon glyphicon-arrow-right"></span>
          encode
          <span class="glyphicon glyphicon-arrow-right"></span>
        </button>
        <button id="decode" class="convert btn-success form-control">
          <span class="glyphicon glyphicon-arrow-left"></span>
          decode
          <span class="glyphicon glyphicon-arrow-left"></span>
        </button>
      </div>
      <div class="col-sm-5">
        <h5 for="buffer">MessagePack (Uint8Array)
          <label for="hex"><input type="radio" id="hex" name="bintype" value="hex" checked> HEX</label>
          <label for="array"><input type="radio" id="array" name="bintype" value="array"> Array</label>
        </h5>
        <textarea class="form-control" id="buffer"></textarea>
      </div>
    </div>
  </div>

</form>
</body>
</html>
